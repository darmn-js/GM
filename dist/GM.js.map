{"version":3,"file":"GM.js","sources":["../functions/couchHandler.js"],"sourcesContent":["/* eslint-disable import/no-unresolved */\nimport API from 'src/util/api';\nimport UI from 'src/util/ui';\n\nexport class couchHandler {\n  constructor(sample, roc, options = {}) {\n    let {\n      couchDB = {\n        url: 'https://gat.mylims.org/roc',\n        database: 'eln',\n        kind: 'sample',\n      },\n      reference = undefined,\n    } = options;\n    this.reference = reference;\n    this.targetReference = reference.split(' ')[0];\n    this.couchDB = couchDB;\n    this.roc = roc;\n    this.sample = sample;\n  }\n\n  updateSample(sample) {\n    this.sample = sample;\n  }\n\n  getToc(toc, varName) {\n    const targetReference = this.targetReference;\n    this.roc.query(toc).then(function (data) {\n      data = data.filter(\n        (item) => item.value.reference.split(' ')[0] === targetReference,\n      );\n      API.createData(varName, data);\n    });\n  }\n\n  loadSampleFeatures(viewKind, options) {\n    const { showNotification = true } = options;\n    const content = this.sample.sample.$content;\n    const sampleKind = this.getParentKind();\n    const sampleIdentifier =\n      sampleKind === viewKind\n        ? content.general.metadata.sampleIdentifier\n        : 'This field must be replace it';\n    API.createData('content', content);\n    API.createData('sampleIdentifier', sampleIdentifier);\n    if (showNotification) {\n      UI.showNotification('Updated current sample', 'success');\n    }\n  }\n\n  async createSample(entrysample, kind, sampleBatch, sampleReference) {\n    const roc = this.roc;\n    UI.confirm(`<div> Are you sure to save: ${sampleBatch}? </div>`).then(\n      function (result) {\n        if (!result) return;\n        entrysample.$id = [sampleReference, sampleBatch];\n        entrysample.$content.general.kind = kind;\n        if (result.sample) entrysample.$id.push(result.sample);\n        let userInfo = API.cache('userInfo');\n        if (userInfo) {\n          entrysample.$owners = [userInfo.email];\n        }\n        roc.create(entrysample);\n        API.doAction('updateSamples');\n      },\n    );\n  }\n\n  getJSONTemplate() {\n    const result = {\n      $type: 'entry',\n      $id: ['reference', 'batchID'],\n      $kind: 'sample',\n      $owners: ['admin@cheminfo.org'],\n      $content: '',\n      $lastModification: 'admin@cheminfo.org',\n      $modificationDate: '',\n      $creationDate: '',\n    };\n    result.$content = this.sample.sample.$content;\n    result.$content.image = [];\n    result.$content.spectra = {};\n    result.$content.general.metadata.parent = this.getParent();\n    result.$content.general.metadata.sampleIdentifier = API.getData(\n      'sampleIdentifier',\n    ).resurrect();\n    return result;\n  }\n\n  getParentKind() {\n    return this.sample.sample.$content.general.kind;\n  }\n\n  getParent() {\n    const sample = this.sample.sample;\n    return {\n      reference: sample.$id[0],\n      batch: sample.$id[1],\n      uuid: sample._id,\n    };\n  }\n\n  builtSampleBatch() {\n    const sampleIdentifier = API.getData('sampleIdentifier').resurrect();\n    return `${sampleIdentifier}`;\n  }\n}\n"],"names":["couchHandler","constructor","sample","roc","options","couchDB","url","database","kind","reference","undefined","targetReference","split","updateSample","getToc","toc","varName","query","then","data","filter","item","value","API","createData","loadSampleFeatures","viewKind","showNotification","content","$content","sampleKind","getParentKind","sampleIdentifier","general","metadata","UI","createSample","entrysample","sampleBatch","sampleReference","confirm","result","$id","push","userInfo","cache","$owners","email","create","doAction","getJSONTemplate","$type","$kind","$lastModification","$modificationDate","$creationDate","image","spectra","parent","getParent","getData","resurrect","batch","uuid","_id","builtSampleBatch"],"mappings":"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"}